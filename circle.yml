database:
  pre:
    - brew services start mysql
dependencies:
  cache_directories:
    - /usr/local/lib/python2.7/site-packages
  override:
    - pip2 install --editable .[test] --upgrade
  pre:
    - brew update && brew install awscli mysql upx python wxpython
    - pip2 install --upgrade cython numpy scipy
deployment:
  nightly:
    branch: master
    commands:
      - pip2 install --upgrade pyinstaller
      - pyinstaller CellProfiler.spec
      - cp /usr/local/Cellar/libpng/1.6.31/lib/libpng16.16.dylib dist/CellProfiler.app/Contents/MacOS
      - rm dist/CellProfiler.app/Contents/MacOS/libwx*3.0.dylib
      - hdiutil create -srcfolder dist/CellProfiler.app -volname CellProfiler -fs HFS+ -fsargs "-c c=64,a=16,e=16" -format UDRW -size 500000k dist/CellProfiler-nightly.dmg
      - aws s3 sync dist s3://cellprofiler-releases --exclude "*" --include "CellProfiler-nightly.dmg" --delete
general:
  artifacts:
    - dist/CellProfiler.app
machine:
  xcode:
    version: 8.2
test:
  override:
    - echo "foo"
